# =============================================================================
# QuantML Studio v4.0 - Docker Compose Configuration
# =============================================================================

version: '3.8'

services:
  # Main Streamlit Application
  streamlit:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: quantml-streamlit
    ports:
      - "8501:8501"
    volumes:
      - ./models:/app/models
      - ./data:/app/data
      - ./logs:/app/logs
    environment:
      - PYTHONPATH=/app
      - STREAMLIT_SERVER_PORT=8501
      - STREAMLIT_SERVER_ADDRESS=0.0.0.0
    command: streamlit run app.py --server.port=8501 --server.address=0.0.0.0
    restart: unless-stopped
    networks:
      - quantml-network

  # REST API Server
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: quantml-api
    ports:
      - "8000:8000"
    volumes:
      - ./models:/app/models
      - ./logs:/app/logs
    environment:
      - PYTHONPATH=/app
    command: uvicorn api:app --host 0.0.0.0 --port 8000
    restart: unless-stopped
    networks:
      - quantml-network

  # Redis for caching (optional)
  redis:
    image: redis:7-alpine
    container_name: quantml-redis
    ports:
      - "6379:6379"
    volumes:
      - redis-data:/data
    restart: unless-stopped
    networks:
      - quantml-network

networks:
  quantml-network:
    driver: bridge

volumes:
  redis-data:

# =============================================================================
# Usage Instructions:
# =============================================================================
#
# Start all services:
#   docker-compose up -d
#
# Start specific service:
#   docker-compose up -d streamlit
#
# View logs:
#   docker-compose logs -f
#
# Stop all services:
#   docker-compose down
#
# Rebuild and start:
#   docker-compose up -d --build
#
# Access:
#   - Streamlit UI: http://localhost:8501
#   - REST API: http://localhost:8000
#   - API Docs: http://localhost:8000/docs
#
# =============================================================================
